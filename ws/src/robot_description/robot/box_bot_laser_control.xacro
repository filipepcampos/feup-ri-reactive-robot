<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <xacro:macro  name="reactive_robot_custom_control" params="robot_name parent">

      
      <link name="${robot_name}_laser_scan_link">
        <visual name="${robot_name}_visual_laser_scan_link">
          <origin rpy="0 0 0" xyz="0 0 0"/>
          <geometry>
            <box size="0.02 0.02 0.02"/>
          </geometry>
        </visual>

        <collision name="${robot_name}_collision_laser_scan_link">
          <origin rpy="0 0 0" xyz="0 0 0"/>
          <geometry>
            <box size="0.02 0.02 0.02"/>
          </geometry>
        </collision>

        <inertial>

          <mass value="0.01"/>
          <origin rpy="0 0 0" xyz="0 0 0.0204"/>
          <inertia ixx="6.066578520833334e-06" ixy="0" ixz="0" iyy="6.066578520833334e-06" iyz="0" izz="9.365128684166666e-06"/>
        </inertial>
      </link>

      <joint name="${robot_name}_laser_scan_link_joint" type="prismatic">
        <origin rpy="0 0 0" xyz="0.0 0.0 0.05"/>
        <parent link="${parent}"/>
        <child link="${robot_name}_laser_scan_link"/>
        <axis xyz="0 0 1"/>
        <limit lower="-0.1" upper="0.0" effort="20.0" velocity="2.0"/>
        <dynamics damping="0.1" friction="1.0"/>
      </joint>

      <!-- Visual Laser Model to be rotated -->
      <link name="${robot_name}_laser_scan_model_link">
        <visual name="${robot_name}_visual_laser_scan_link">
          <origin rpy="0 0 0" xyz="0 0 0"/>
          <geometry>
            <mesh filename="package://robot_description/meshes/sensors/rplidar.dae" scale="1.0 1.0 1.0"/>
          </geometry>
        </visual>

        <collision name="${robot_name}_collision_laser_scan_link">
          <origin rpy="0 0 0" xyz="0 0 0.0204"/>
          <geometry>
            <cylinder length="0.0408" radius="0.037493"/>
          </geometry>
        </collision>

        <inertial>

          <mass value="0.01"/>
          <origin rpy="0 0 0" xyz="0 0 0.0204"/>
          <inertia ixx="6.066578520833334e-06" ixy="0" ixz="0" iyy="6.066578520833334e-06" iyz="0" izz="9.365128684166666e-06"/>
        </inertial>
      </link>

      <joint name="${robot_name}_laser_scan_model_link_joint" type="continuous">
        <origin rpy="0 0 0" xyz="0.0 0.0 0.0"/>
        <parent link="${robot_name}_laser_scan_link"/>
        <child link="${robot_name}_laser_scan_model_link"/>
        <axis xyz="0 0 1"/>
        <limit effort="10.0" velocity="2.0"/>
        <dynamics friction="0.01"/>
      </joint>

      <ros2_control name="${robot_name}_GazeboSystem" type="system">

          <hardware>
            <plugin>gazebo_ros2_control/GazeboSystem</plugin>
          </hardware>

          <joint name="${robot_name}_laser_scan_link_joint">
            <command_interface name="position">
              <param name="min">-0.05</param>
              <param name="max">0.0</param>
            </command_interface>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
            <state_interface name="effort"/>
          </joint>

          <joint name="${robot_name}_laser_scan_model_link_joint">
            <command_interface name="velocity">
              <param name="min">0.0</param>
              <param name="max">2.0</param>
            </command_interface>
            <state_interface name="position"/>
            <state_interface name="velocity"/>
            <state_interface name="effort"/>
          </joint>

      </ros2_control>


      <gazebo>
        <plugin filename="libgazebo_ros2_control.so" name="${robot_name}_gazebo_ros2_control">
          <ros>
            <namespace>${robot_name}</namespace>
          </ros>
          <parameters>$(find robot_description)/config/${robot_name}_controller_position_velocity.yaml</parameters>
          <robot_param_node>/${robot_name}_robot_state_publisher</robot_param_node>
        </plugin>
      </gazebo>

    </xacro:macro >

</robot>